---
title: "Real_state"
author: "Ignacio Almodóvar, Luis Rodríguez, Javier Muñoz"
date: "12/4/2021"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

First of all, we are going to read the Boston house prices dataset file and show the summary and the structure:

```{r}
dataset <- read.csv("Dataset.csv")

summary(dataset)
str(dataset)

```

Next step is to convert the type of the categorical variable _CHAS_ into factor (no bounds, bounds) and create a few categorical variables from suitable quantitative ones:

- _RAD.CAT_: low, medium and high
- _RM.CAT_: low, medium and high
- _INDUS.CAT_: very low, low, high and very high
- _LSTAT.CAT_: very low, low, high and very high
- _ZN.CAT_: very low, low, high and very high

```{r}

dataset$CHAS <- factor(dataset$CHAS, labels=c("no bounds", "bounds"))

factor_rad_values <- sort(unique(dataset$RAD))
delimiter_rad_index <- length(factor_rad_values)/3
lower_delimiter_rad_value <- factor_rad_values[round(delimiter_rad_index)]
upper_delimiter_rad_value <- factor_rad_values[round(2*delimiter_rad_index)]

dataset$RAD.CAT <- cut(dataset$RAD, 
    breaks = c(-Inf, lower_delimiter_rad_value, upper_delimiter_rad_value, Inf), 
    labels = c('low', 'medium', 'high'),
    right = FALSE)

dataset$RM.CAT <- cut(dataset$RM, 
    breaks = c(-Inf, 4, 6, Inf), 
    labels = c('low', 'medium', 'high'),
    right = FALSE)

factor_indus_values <- sort(unique(dataset$INDUS))
delimiter_indus_index <- length(factor_indus_values)/4
lower_delimiter_indus_value <- factor_indus_values[round(delimiter_indus_index)]
mid_delimiter_indus_value <- factor_indus_values[round(2*delimiter_indus_index)]
upper_delimiter_indus_value <- factor_indus_values[round(3*delimiter_indus_index)]

dataset$INDUS.CAT <- cut(dataset$INDUS, 
    breaks = c(-Inf, lower_delimiter_indus_value, mid_delimiter_indus_value, upper_delimiter_indus_value, Inf), 
    labels = c('very low', 'low', 'high', 'very high'),
    right = FALSE)

dataset$LSTAT.CAT <- cut(dataset$LSTAT, 
    breaks = c(-Inf, 25, 50, 75, Inf), 
    labels = c('very low', 'low', 'high', 'very high'),
    right = FALSE)

dataset$ZN.CAT <- cut(dataset$ZN, 
    breaks = c(-Inf, 25, 50, 75, Inf), 
    labels = c('very low', 'low', 'high', 'very high'),
    right = FALSE)

str(dataset)

```

We are going to define a method to generate the kernel plots: withouth any categorical variable and groupped by one qualitative:

```{r}

if (!require(RColorBrewer)) install.packages("RColorBrewer")
library(RColorBrewer)

kernel_by_factors <- function(x, x_name, type_color) {
  factors <- Filter(is.factor, dataset)
  num_vars <- ncol(factors)
  mod <- num_vars %% 2 
  
  colors = brewer.pal(n = num_vars + 1, name=type_color)

  par(mfrow=c(num_vars+mod+1,2), mar=c(2,2,2,2))
  plot(density(x,kernel="gaussian"),
   ylab="Density",
   main=paste0("Kernel density of ", x_name),
   xlab=x_name,
   col=colors[1],
   lwd=5)
  
  index_factor <- 1
  for(factor in factors) {
    plot_kernel_charts(x, factor[!is.na(factor)], x_name, names(factors[index_factor]), colors)
    index_factor = index_factor + 1
  }
}

plot_kernel_charts <- function(x, cat, x_name, cat_name, colors) {
  cat_values <- levels(cat)
  num_colors <- length(cat_values)
  
  min_x <<- c()
  max_x <<- c()
  min_y <<- c()
  max_y <<- c()
  
  densities <<- list()
  
  for(cat_value in cat_values)
    generate_kernel_by_cat_value(x, cat, cat_value)
  
  min_x <- min(min_x)
  max_x <- max(max_x)
  min_y <- min(min_y)
  max_y <- max(max_y)
  
  plot(c(min_x,max_x),c(min_y,max_y),
       xlab=x_name,
       ylab="Density",
       main=paste0("Kernel: ", x_name, " in terms of ", cat_name),
       type="n")
  legend(x="topright", legend=c(cat_values),col=colors[-1], lty=1, cex=0.8,
     box.lty=0)
  i <- 2
  for(densitiy_by_cat in densities) {
    lines(densitiy_by_cat$x, densitiy_by_cat$y, col=colors[i], lwd=1)
    i = i + 1
  }
}

generate_kernel_by_cat_value <- function(x, cat, cat_value){
  if(length(cat[cat==cat_value]) > 2){
    d_cat_value <- density(x[cat==cat_value], kernel="gaussian")
    min_x <<- c(min_x, min(d_cat_value$x))
    max_x <<- c(max_x, max(d_cat_value$x))
    min_y <<- c(min_y, min(d_cat_value$y))
    max_y <<- c(max_y, max(d_cat_value$y))
    
    densities <<- append(densities, list(d_cat_value))
  }
}

```

Calling the method above with the parameters of interest: _TAX_, _MEDV_, _CRIM_ and _NOX_

```{r fig.height=14}
kernel_by_factors(dataset$TAX, "TAX", "Set1")
```

```{r fig.height=14}
kernel_by_factors(dataset$MEDV, "MEDV", "Dark2")
```

```{r fig.height=14}
kernel_by_factors(dataset$CRIM, "CRIM", "Paired")
```

```{r fig.height=14}
kernel_by_factors(dataset$NOX, "NOX", "Accent")
```

We are going to visualize the matrix correlation between each variable:

```{r fig.width=14, fig.height=14}
if (!require(ggplot2)) install.packages("ggplot2")
if (!require(GGally)) install.packages("GGally")
library(ggplot2)
library(GGally)

is.not.fact <- sapply(dataset, Negate(is.factor))
dataset.no.factors <- dataset[,is.not.fact]
ggpairs(dataset.no.factors, title="Pairwise variable correlation")

```

# Outliers


